import{c as u,w as P,v as R,o as _,a as b,b as r,t as z,_ as re,r as i,d as T,e as se,f as ae,g as le,h as ie,n as ue,u as ce}from"./index-7580991e.js";const de={class:"w-20 h-20"},me=["stroke-dasharray","stroke-dashoffset"],fe={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 absolute text-xl text-emerald-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},ve={key:1,class:"absolute text-xl text-blue-700"},we={__name:"PowerButton",props:{isPressed:{type:Boolean,required:!0},isRunning:{type:Boolean,required:!0},isDownloadCompleted:{type:Boolean,required:!0},progressTicks:{type:Number,required:!0}},emits:["power-on"],setup(q,{emit:c}){const s=q,p=c,y=u(()=>!s.isDownloadCompleted&&!s.isPressed||s.isDownloadCompleted&&!s.isRunning),w=u(()=>!s.isPressed||s.progressTicks>=0),d=u(()=>(s.progressTicks<1?s.progressTicks:1)*100),m=u(()=>`${d.value.toFixed(0)}%`),n=u(()=>{const f=60*Math.PI,l=f-d.value/100*f;return{strokeDasharray:f,strokeDashoffset:l}}),a=()=>{s.isPressed||p("power-on")};return(f,l)=>P((_(),b("div",{class:"inline-flex items-center justify-center overflow-hidden rounded-full bg-white hover:cursor-pointer",onClick:a},[(_(),b("svg",de,[l[0]||(l[0]=r("circle",{class:"text-gray-300","stroke-width":"5",stroke:"currentColor",fill:"transparent",r:"30",cx:"40",cy:"40"},null,-1)),r("circle",{class:"text-blue-600","stroke-width":"5","stroke-linecap":"round",stroke:"currentColor",fill:"transparent",r:"30",cx:"40",cy:"40","stroke-dasharray":n.value.strokeDasharray,"stroke-dashoffset":n.value.strokeDashoffset},null,8,me)])),y.value?(_(),b("svg",fe,l[1]||(l[1]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)]))):(_(),b("span",ve,z(m.value),1))],512)),[[R,w.value]])}};const pe={id:"virtual-keyboard-caller-box"},he={class:"mt-5 px-3 w-full flex justify-between"},ge={__name:"HomeView",setup(q){const c=i(-1),s=i(null),p=i(0),y=i(null),w=i(" "),d=i(!1),m=i(!1),n=i(null),a=i({isPaused:!1,mouseEnabled:!1}),f="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,l={xpud:{memory_size:512*1024*1024,vga_memory_size:32*1024*1024,cdrom:{url:"./machine/xpud.iso",size:66529280}}},h=u(()=>a.value.isPaused?!0:n.value&&n.value.is_running()),D=u(()=>!!document.fullscreenElement),$=u(()=>!m.value&&!d.value||m.value&&!h.value),V=u(()=>`width: 100%; height: ${p.value}px;`),I=[{name:"download-progress",method:e=>{if(c.value=0,e.file_name.endsWith(".wasm")){const t=e.file_name.split("/"),o=t[t.length-1];g(`Fetching "${o}" ...`);return}if(e.file_index===e.file_count-1&&e.loaded>=e.total-2048){m.value=!0,g("Download completed!"),d.value||g("Click power button to start."),c.value=-1;return}typeof e.file_index=="number"&&e.file_count&&g(`Downloading images (${e.file_index+1}/${e.file_count}) ...`),e.total&&typeof e.loaded=="number"?c.value=e.loaded/e.total:g(`Progress: ${c.value++%50}`)}},{name:"download-error",method:e=>{c.value=0,progressState.value=`
        Error: Loading "${e.file_name}" failed.
        Check your connection and reload the page to try again later.
      `}},{name:"mouse-enable",method:e=>{a.value.mouseEnabled=e}},{name:"screen-set-mode",method:()=>{requestAnimationFrame(()=>{S()})}},{name:"screen-set-size-graphical",method:()=>{requestAnimationFrame(()=>{S()})}},{name:"emulator-stopped",method:()=>{D.value&&X()}}];T(m,e=>{!e||!d.value||setTimeout(()=>{F()},500)}),T(w,e=>{if(e!==" "){if(e==="")O(14);else{const t=e.substring(1);N(t)}window.requestAnimationFrame(()=>{w.value=" "})}});function g(e){console.info(`[Lucid] ${e}`)}function A(){return n.value}window.currentEmulator=A;function E(){var k,x,B,L;let e=!1,t=640,o=480;const v=(L=(B=(x=(k=n.value)==null?void 0:k.v86)==null?void 0:x.cpu)==null?void 0:B.devices)==null?void 0:L.vga;return h.value&&v&&(e=v.graphical_mode,t=v.screen_width||t,o=v.screen_height||o,console.log(v,e,t,o)),{isGraphic:e,width:t,height:o}}function H(e){const t=e.get("profile"),o=e.get("network_relay_url");return{wasm_path:"./v86.wasm",bios:{url:"./machine/bios/seabios.bin"},vga_bios:{url:"./machine/bios/vgabios.bin"},screen_container:s.value,network_relay_url:o||"wss://relay.widgetry.org/",...l[t]||l.xpud}}function K(e){const{V86Starter:t}=window;n.value=new t(e)}function M(){for(const e of I)n.value.add_listener(e.name,e.method)}function C(e){n.value.screen_set_scale(e)}window.emulatorScreenSetScale=C;async function U(){const e=await n.value.save_state(),t=new Blob([e]),o=document.createElement("a");o.download="lucid-state.bin",o.href=window.URL.createObjectURL(t),o.dataset.downloadurl=`application/octet-stream:${o.download}:${o.href}`,o.click()}window.emulatorStateSave=U;function j(e){n.value.stop();const t=new FileReader;t.onload=o=>{n.value.restore_state(o.target.result),n.value.run()},t.readAsArrayBuffer(e)}window.emulatorStateRestore=j;function F(){d.value=!0,m.value&&(h.value?(n.value.stop(),n.value.restart()):n.value.run())}function N(e){n.value.keyboard_send_text(e)}function O(e){n.value.bus.send("keyboard-code",e)}function W(){a.value.isPaused?(n.value.run(),a.value.isPaused=!1):(n.value.stop(),a.value.isPaused=!0)}function G(){n.value.restart()}function J(){const e=document.body,t=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock||e.msRequestPointerLock;if(!t){console.warn("The browser is not support requestPointerLock");return}t.call(e)}function Q(){const e=s.value,t=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen;if(!t){console.warn("The browser is not support requestFullscreen");return}t.call(e)}function X(){const e=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen;if(!e){console.warn("The browser is not support exitFullscreen");return}e.call(element)}function S(){if(!h.value)return;const e=E();if(!e.isGraphic){C(1);return}const{clientWidth:t}=document.body,{width:o,height:v}=e,k=t/o,x=k>1?1:k;C(x),p.value=v*x}function Y(){a.value.mouseEnabled&&J()}function Z(){F()}function ee(){W()}function te(){G()}function oe(){Q()}function ne(){y.value.focus()}return se(()=>{window.addEventListener("resize",S);const e=E();p.value=e.height;const t=new URLSearchParams(window.location.search),o=H(t);K(o),M()}),ae(()=>{window.removeEventListener("resize",S)}),(e,t)=>(_(),b("div",null,[le(we,{class:"fixed top-3 right-0 md:right-1/2 2xl:right-2","is-pressed":d.value,"is-running":h.value,"is-download-completed":m.value,"progress-ticks":c.value,onPowerOn:F},null,8,["is-pressed","is-running","is-download-completed","progress-ticks"]),r("div",{ref_key:"screenContainer",ref:s,class:"bg-black overflow-hidden",style:ue(V.value),onClick:Y},[t[1]||(t[1]=r("div",{id:"screen"},null,-1)),t[2]||(t[2]=r("canvas",{id:"vga",class:"mx-auto"},null,-1)),r("div",pe,[P(r("textarea",{id:"virtual-keyboard-caller",ref_key:"virtualKeyboardCaller",ref:y,"onUpdate:modelValue":t[0]||(t[0]=o=>w.value=o),autocorrect:"off",autocapitalize:"none",spellcheck:"false",tabindex:"0"},null,512),[[ie,w.value]])])],4),P(r("div",he,[r("button",{class:"w-16 text-base font-medium text-gray-600 hover:text-gray-500",onClick:Z}," 電源 "),r("button",{class:"w-16 text-base font-medium text-gray-600 hover:text-gray-500",onClick:ee},z(a.value.isPaused?"恢復":"暫停"),1),r("button",{class:"w-16 text-base font-medium text-gray-600 hover:text-gray-500",onClick:te}," 重置 "),P(r("button",{class:"w-28 text-base font-medium text-gray-600 hover:text-gray-500",onClick:ne}," 呼出虛擬鍵盤 ",512),[[R,ce(f)]]),r("button",{class:"w-28 text-base font-medium text-gray-600 hover:text-gray-500",onClick:oe}," 進入全螢幕 ")],512),[[R,!$.value]])]))}},xe=re(ge,[["__scopeId","data-v-f0a87ea4"]]);export{xe as default};
