import{_ as ne,r as a,c as l,w as B,o as re,a as ae,b as w,d as h,e as g,v as _,f as r,t as L,g as se,u as le}from"./index-18828133.js";const ue={class:"w-20 h-20"},ie=["stroke-dasharray","stroke-dashoffset"],ce={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 absolute text-xl text-emerald-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},de={key:1,class:"absolute text-xl text-blue-700"},ve={id:"virtual-keyboard-caller-box"},fe={class:"mt-5 px-3 w-full flex justify-between"},me={__name:"HomeView",setup(we){const c=a(null),y=a(null),i=a(!1),d=a(!1),s=a(-1),o=a(null),u=a({isPaused:!1,mouseEnabled:!1});a(null);const m=a(" "),q="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,S={xpud:{memory_size:512*1024*1024,vga_memory_size:32*1024*1024,cdrom:{url:"./machine/xpud.iso",size:66529280}}},p=l(()=>u.value.isPaused?!0:o.value&&o.value.is_running()),z=l(()=>!!document.fullscreenElement),D=l(()=>!i.value||s.value>=0),P=l(()=>!d.value&&!i.value||d.value&&!p.value),C=l(()=>(s.value<1?s.value:1)*100),T=l(()=>`${C.value.toFixed(0)}%`),R=l(()=>{const e=60*Math.PI,t=e-C.value/100*e;return{strokeDasharray:e,strokeDashoffset:t}}),x=l(()=>o.value?o.value.v86.cpu.devices.vga.stats:{}),V=[{name:"download-progress",method:e=>{if(s.value=0,e.file_name.endsWith(".wasm")){const t=e.file_name.split("/"),n=t[t.length-1];v(`Fetching "${n}" ...`);return}if(e.file_index===e.file_count-1&&e.loaded>=e.total-2048){d.value=!0,v("Download completed!"),i.value||v("Click power button to start."),s.value=-1;return}typeof e.file_index=="number"&&e.file_count&&v(`Downloading images (${e.file_index+1}/${e.file_count}) ...`),e.total&&typeof e.loaded=="number"?s.value=e.loaded/e.total:v(`Progress: ${s.value++%50}`)}},{name:"download-error",method:e=>{s.value=0,progressState.value=`
        Error: Loading "${e.file_name}" failed.
        Check your connection and reload the page to try again later.
      `}},{name:"mouse-enable",method:e=>{u.value.mouseEnabled=e}},{name:"screen-set-mode",method:()=>{f()}},{name:"screen-set-size-graphical",method:()=>{f()}},{name:"emulator-stopped",method:()=>{z.value&&J()}}];B(d,e=>{!e||!i.value||setTimeout(()=>{k()},500)}),B(m,e=>{if(e!==" "){if(e==="")A(14);else{const t=e.substring(1);H(t)}window.requestAnimationFrame(()=>{m.value=" "})}});function v(e){console.info(`[Lucid] ${e}`)}function $(){return o.value}window.currentEmulator=$;function M(e){const t=e.get("profile"),n=e.get("network_relay_url");return{wasm_path:"./v86.wasm",bios:{url:"./machine/bios/seabios.bin"},vga_bios:{url:"./machine/bios/vgabios.bin"},screen_container:c.value,network_relay_url:n||"wss://relay.widgetry.org/",...S[t]||S.xpud}}function I(e){const{V86:t}=window;o.value=new t(e)}function K(){for(const e of V)o.value.add_listener(e.name,e.method)}function b(e){o.value.screen_set_scale(e)}async function U(){const e=await o.value.save_state(),t=new Blob([e]),n=document.createElement("a");n.download="lucid-state.bin",n.href=window.URL.createObjectURL(t),n.dataset.downloadurl=`application/octet-stream:${n.download}:${n.href}`,n.click()}window.emulatorStateSave=U;function j(e){o.value.stop();const t=new FileReader;t.onload=n=>{o.value.restore_state(n.target.result),o.value.run()},t.readAsArrayBuffer(e)}window.emulatorStateRestore=j;function k(){i.value=!0,d.value&&(p.value?(o.value.stop(),o.value.restart()):o.value.run())}function H(e){o.value.keyboard_send_text(e)}function A(e){o.value.bus.send("keyboard-code",e)}function N(){u.value.isPaused?(o.value.run(),u.value.isPaused=!1):(o.value.stop(),u.value.isPaused=!0)}function O(){o.value.restart()}function W(){const e=document.body,t=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock||e.msRequestPointerLock;t?t.call(e):console.warn("The browser is not support requestPointerLock")}function G(){const e=c.value,t=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen;if(!t){console.warn("The browser is not support requestFullscreen");return}t.call(e)}function J(){const e=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen;e?e.call(document):console.warn("The browser is not support exitFullscreen")}function f(){if(!p.value)return;x.value.is_graphical||b(1);const e={width:c.value.clientWidth||1,height:c.value.clientHeight||1},t={width:x.value.res_x||1,height:x.value.res_y||1};if(e.height>e.width){const n=e.width/t.width,F=e.height/t.height,E=Math.min(n,F);b(E),console.log(E)}else b(1)}function Q(){u.value.mouseEnabled&&W()}function X(){i.value||k()}function Y(){k()}function Z(){N()}function ee(){O()}function te(){G()}function oe(){y.value.focus()}return re(()=>{window.addEventListener("resize",f),f();const e=new URLSearchParams(window.location.search),t=M(e);I(t),K()}),ae(()=>{window.removeEventListener("resize",f)}),(e,t)=>(w(),h("div",null,[g(r("div",{class:"fixed inline-flex items-center justify-center overflow-hidden rounded-full top-3 right-0 md:right-1/2 2xl:right-2 bg-white hover:cursor-pointer",onClick:X},[(w(),h("svg",ue,[t[1]||(t[1]=r("circle",{class:"text-gray-300","stroke-width":"5",stroke:"currentColor",fill:"transparent",r:"30",cx:"40",cy:"40"},null,-1)),r("circle",{class:"text-blue-600","stroke-width":"5","stroke-linecap":"round",stroke:"currentColor",fill:"transparent",r:"30",cx:"40",cy:"40","stroke-dasharray":R.value.strokeDasharray,"stroke-dashoffset":R.value.strokeDashoffset},null,8,ie)])),P.value?(w(),h("svg",ce,t[2]||(t[2]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)]))):(w(),h("span",de,L(T.value),1))],512),[[_,D.value]]),r("div",{class:"bg-black h-96 overflow-hidden",onClick:Q},[r("div",{ref_key:"screenContainer",ref:c},[t[3]||(t[3]=r("div",{id:"screen"},null,-1)),t[4]||(t[4]=r("canvas",{id:"vga",class:"mx-auto"},null,-1)),r("div",ve,[g(r("textarea",{id:"virtual-keyboard-caller",ref_key:"virtualKeyboardCaller",ref:y,"onUpdate:modelValue":t[0]||(t[0]=n=>m.value=n),autocorrect:"off",autocapitalize:"none",spellcheck:"false",tabindex:"0"},null,512),[[se,m.value]])])],512)]),g(r("div",fe,[r("button",{class:"w-16 text-base font-medium text-gray-600 hover:text-gray-500",onClick:Y}," 電源 "),r("button",{class:"w-16 text-base font-medium text-gray-600 hover:text-gray-500",onClick:Z},L(u.value.isPaused?"恢復":"暫停"),1),r("button",{class:"w-16 text-base font-medium text-gray-600 hover:text-gray-500",onClick:ee}," 重置 "),g(r("button",{class:"w-28 text-base font-medium text-gray-600 hover:text-gray-500",onClick:oe}," 呼出虛擬鍵盤 ",512),[[_,le(q)]]),r("button",{class:"w-28 text-base font-medium text-gray-600 hover:text-gray-500",onClick:te}," 進入全螢幕 ")],512),[[_,!P.value]])]))}},ge=ne(me,[["__scopeId","data-v-a43e6c49"]]);export{ge as default};
